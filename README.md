# Capstone Project - Foreign Language Online School (FLOS) App

This app is designed so students can find a foreign language instructor who also speaks their native language.

The app includes 2 classes (student and instructor), and 2 roles (student and provost).

•	Students have attributes name, studyLanguage, nativeLanguage
•	Instructors have attributes name, teachLanguage, fluentLanguage

The provost is authorized to:
•	GET/allStudents --> returns all students
•	POST/student --> add a student
•	PATCH/student<student_id> --> update student record
•	DELETE/student<student_id> --> delete student record
•	GET/allInstructors --> returns all instructors
•	POST/instructor --> add an instructor
•	PATCH/instructor<instructor_id> --> update instructor record
•	DELETE/ instructor<instructor_id> --> delete instructor record
•	GET/instructorMatches<student_id> --> return all instructors who match the student profile

The student is provided with their id and is only authorized to:
•	GET/instructorMatches<student_id> --> return all instructors who match the student profile



## Backend

The backend is hosted on Heroku, and can accessed at https://evening-shelf-04999-b23c8136f825.herokuapp.com/

The code repo is https://github.com/jerseyboy84/FLOS

#  ----------------------------------------------------------------
#  Getting Started
#  ----------------------------------------------------------------

Local development and testing was done before deploying to Heroku.  

The "flos" database has been pre-populated with 10 students and 6 instructors.   This database can be re-initialized locally with these CLI commands:

dropdb flos
createdb flos
psql flos < flos.psql

After the database is created, run ". setup.sh" to initialize the OS environment variables.  The variables include the flask application name, operational and test databases, as well as JWTs for the 2 defined roles.  To initialize these variables, run:

. setup.sh

Auth0 JWTs have a maximum lifetime of 24 hrs, and this seems to be a pain point for the Auth0 user community.   This thread describes the limitation, which is presumably in place to meet a certain security standard.
https://community.auth0.com/t/how-to-change-the-access-token-expiry/10222

Both JWTs were generated shortly before submitting this project.  If the project review takes longer than 24 hrs, these will need to be re-generated by the Udacity reviewer.    If that is required, these credentials should be used:
https://hornygoat.us.auth0.com/authorize?audience=FLOS&response_type=token&client_id=BkS2QruZS2CZddpEz2YULpdTcVETC6LS&redirect_uri=http://localhost:8080

The "provost" role is covered by:
username = bigdog@flos.edu 
password =Provost!rules

The "student" role is covered by:
username = freshman@flos.edu 
password =New2languages

The python code includes these files:
app.py - the entry point and contains all the endpoints and controller logic
models.py - defines the Instructor and Student classes, and associated methods for managing the database
auth.py - contains the logic to authenticate the authorization header, and check if the action requested is permitted
test_app.py - contains the TestCase class unittest boh positive and negative test cases 


To start the backend operation, run this command: flask run


#  ----------------------------------------------------------------
#  API reference
#  ----------------------------------------------------------------


#  Getting Started
#  ----------------------------------------------------------------

The base URL for local testing is http://127.0.0.1:5000
Authentication is required for all endpoints.   See the details for generating Auth0 JWTs above


#  Error handling
#  ----------------------------------------------------------------

Errors are returned as JSON objects in the following format, with error 404 as an example:
{
    "success": False,
    "error": 404,
    "message": "Resource not found"
}

The API will generate the following errors:
400: Bad Request
401: Unauthorized
403: Forbidden
404: Resource not found
405: Method not allowed


#  Endpoints
#  ----------------------------------------------------------------
There are 9 endpoints defined:

#  ----------------------------------------------------------------
GET /allInstructors
Returns a JSON object with all instructors including id (integer), name (string), language of instruction (string), and language of fluency (string)

Sample request:
curl http://127.0.0.1:5000/allInstructors

Sample response:
{
    "instructors": [
        {
            "fluentLanguage": "English",
            "id": 1,
            "name": "Fernando Gomez",
            "teachLanguage": "Spanish"
        },
        {
            "fluentLanguage": "Spanish",
            "id": 2,
            "name": "Frida Armoir",
            "teachLanguage": "French"
        },
        {
            "fluentLanguage": "English",
            "id": 3,
            "name": "Helen Lin",
            "teachLanguage": "Chinese"
        },
    ],
    "success": true,
    "totalInstructors": 3
}

#  ----------------------------------------------------------------
GET /allStudents
Returns a JSON object with all instructors including id (integer), name (string), language of learning (string), and native language (string)

Sample request:
curl http://127.0.0.1:5000/allStudents

Sample response:
{
    "students": [
        {
            "id": 1,
            "name": "Kayla Rhodes",
            "nativeLanguage": "English",
            "studyLanguage": "Spanish"
        },
        {
            "id": 2,
            "name": "Macario Aparicio",
            "nativeLanguage": "Spanish",
            "studyLanguage": "French"
        },
        {
            "id": 3,
            "name": "Eric Goodill",
            "nativeLanguage": "English",
            "studyLanguage": "Chinese"
        },
        {
            "id": 4,
            "name": "Joel Fisher",
            "nativeLanguage": "English",
            "studyLanguage": "Chinese"
        },
        {
            "id": 5,
            "name": "Huiming Wen",
            "nativeLanguage": "Chinese",
            "studyLanguage": "English"
        }
    ],
    "success": true,
    "totalStudents": 5
}

#  ----------------------------------------------------------------
GET /instructorMatches<student_id>
Returns a JSON object with all instructors who are fluent in the student's native language, and who teach the language which the student wants to study.  The returned object includes the total number of matches (integer), and for each match returns the instructor id (integer), name (string), language of instruction (string), and language of fluency (string).

Sample request:
curl http://127.0.0.1:5000/instructorMatches/5

Sample response:
{
    "instructors": [
        {
            "fluentLanguage": "Chinese",
            "id": 4,
            "name": "Angela Luo",
            "teachLanguage": "English"
        },
        {
            "fluentLanguage": "Chinese",
            "id": 6,
            "name": "Sean Li",
            "teachLanguage": "English"
        }
    ],
    "success": true,
    "totalMatchInstructors": 2
}

#  ----------------------------------------------------------------
POST /instructor
Request includes a JSON object containing the name (string), language of instruction (string), and language of fluency (string) of an instructor to be added.   When successful, the returned JSON object contains the newly added instructor id (integer), and new total number of instructors (integer).

Sample request:
curl -X POST -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" -d {"name": "Sean Li", "teachLanguage": "English", "fluentLanguage": "Chinese"}' http://127.0.0.1:5000/instructor


Sample response:
{
    "created": 6,
    "success": true,
    "totalInstructors": 6
}

#  ----------------------------------------------------------------
POST /student
Request includes a JSON object containing the name (string), language of learning (string), and native language (string) of a student to be added.   When successful, the returned JSON object contains the newly added student id (integer), and new total number of students (integer).

Sample request:
curl -X POST -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" -d {"name": "Xiaolan Zhuo", "studyLanguage": "English", "nativeLanguage": "Chinese"}' http://127.0.0.1:5000/student

Sample response:
{
    "created": 10,
    "success": true,
    "totalStudents": 10
}

#  ----------------------------------------------------------------
PATCH /instructor/<instructor_id>
Request includes a JSON object containing the id (integer), name (string), language of instruction (string), and language of fluency (string) of an instructor to be edited.   When successful, the returned JSON object contains the name (string), language of instruction (string), and language of fluency (string) of the edited instructor.

Sample request:
curl -X PATCH -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" -d {"id": 6, "name": "Fungqi Li", "teachLanguage": "English", "fluentLanguage": "Chinese"}' http://127.0.0.1:5000/instructor/6


Sample response:
{
    "fluentLanguage": "Chinese",
    "name": "Fungqi Li",
    "success": true,
    "teachLanguage": "English"
}

#  ----------------------------------------------------------------
PATCH /student/<student_id>
Request includes a JSON object containing the id (integer), name (string), language of learning (string), and native language (string) of a student to be edited.   When successful, the returned JSON object contains the name (string), language of learning (string), and native language (string) of the edited student.

Sample request:
curl -X PATCH -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" -d {"id": 10, "name": "Henry Zhuo", "studyLanguage": "English", "nativeLanguage": "Chinese"}' http://127.0.0.1:5000/student/10

Sample response:
{
    "name": "Henry Zhuo",
    "nativeLanguage": "Chinese",
    "studyLanguage": "English",
    "success": true
}

#  ----------------------------------------------------------------
DELETE /instructor/<instructor_id>
Request URL includes the id (integer) of an instructor to be deleted.   When successful, the returned JSON object contains the new total number of instructors (integer).

Sample request:
curl -X DELETE -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" http://127.0.0.1:5000/instructor/6


Sample response:
{
    "success": true,
    "totalInstructors": 5
}

#  ----------------------------------------------------------------
DELETE /student/<student_id>
Request URL includes the id (integer) of a student to be deleted.   When successful, the returned JSON object contains the new total number of students (integer).

Sample request:
curl -X DELETE -H "Content-Type: application/json", "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IktFS1ZJajg0S3NrTmhrbTBRdnVjXyJ9.eyJpc3MiOiJodHRwczovL2hvcm55Z29hdC51cy5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NjYxYWQ5OTIwYmFmNzgwY2FhOTZlZTdjIiwiYXVkIjoiRkxPUyIsImlhdCI6MTcxMzI4NjI5NSwiZXhwIjoxNzEzMzcyNjk1LCJzY29wZSI6IiIsImF6cCI6IkJrUzJRcnVaUzJDWmRkcEV6MllVTHBkVGNWRVRDNkxTIiwicGVybWlzc2lvbnMiOlsiZGVsZXRlOiBpbnN0cnVjdG9yIiwiZGVsZXRlOiBzdHVkZW50IiwiZ2V0OiBpbnN0cnVjdG9yTWF0Y2hlcyIsImdldDogaW5zdHJ1Y3RvcnMiLCJnZXQ6c3R1ZGVudHMiLCJwYXRjaDogaW5zdHJ1Y3RvciIsInBhdGNoOiBzdHVkZW50IiwicG9zdDogaW5zdHJ1Y3RvciIsInBvc3Q6IHN0dWRlbnQiXX0.MmVadZwvhcI_wtzxZMw0Un7ZFjfm2AMpBZ_StPkksARu5dFnLNsdQxziz361PWR_NdRylu30Xk0c6r6jCnAJ6YC-LQHKs4cHa_2qvCu7jw5EV7zcl3Sk-0LdXGu4rici5nGNAJPNRWMjF_wdQblQbwR5laFJysn03iYr3KlTPk1DUGGMZTG0De6u6Y5XDRkKw0R-qHK9GSLY0klQ_ZYwOwTVQKcqUYP-z9_9oTOPgx61njKbgBJjQjzlzeEjp3U9I9omaZ9EWaCVj6_NZ8XTNhsqfxffV-ICdedJ_U06lFGo2PkFAMPKePw6KvK5Zqs1FBAAq2pntQiSw6bRnlNiig" http://127.0.0.1:5000/student/10


Sample response:
{
    "success": true,
    "totalstudents": 9
}

#  ----------------------------------------------------------------
#  Unit Test framework
#  ----------------------------------------------------------------

Test cases for all endpoints have been added to "test_app.py"
These tests will use a test database called "flos-test"
When a new record is created by a POST, a subsequent test will DELETE this record so the database size will not grow with successive test runs

There are 27 test cases defined:

•	GET/allStudents
o	04 -  Success 200 (provost)
o	05 -  Fail 403 (student)
•	POST/student
o	16 - Success 200 (provost)
o	19 - Fail 403 (student)
•	PATCH/student
o	17 - Success 200 (provost)
o	20 - Fail 403 (student)
o	24 - Fail  404 (provost, use invalid id)
•	DELETE/student
o	18 - Success 200 (provost)
o	21 - Fail 403 (student)
o	25 - Fail 404 (provost, use invalid id)
•	GET/allInstructors
o	01 - Success 200 (provost)
o	02 - Fail 403 (student)
o	03 - Fail 401 (use expired token)
•	POST/instructor
o	10 - Success 200 (provost)
o	13 - Fail 403 (student)
•	PATCH/instructor
o	11 - Success 200 (provost)
o	14 - Fail 403 (student)
o	22 - Fail 404 (provost, use invalid id)
•	DELETE/ instructor
o	12 - Success 200 (provost)
o	15 - Fail 403 (student)
o	23 - Fail 404 (provost, use invalid id)
•	GET/instructorMatches
o	06 - Success 200 (provost)
o	08 - Success 200 (student)
o	07 - Fail 404 (provost, use invalid id)
o	09 - Fail 404 (student, use invalid id)
•	Misc bad requests
o	26 - Fail 405 (student, attempt to delete instructor matches)
o	27 - Fail 400 (provost, attempt to post student without a name)

#  ----------------------------------------------------------------
#  Postman Test framework
#  ----------------------------------------------------------------

Postman collections were used to test the deployed version on Heroku.
There is a Postman variable defined to set the "base_url" for local ("FLOS") or Heroku ("production") testing


#  ----------------------------------------------------------------
#  Authors
#  ----------------------------------------------------------------

This application was written by Brian Rockermann

#  ----------------------------------------------------------------
#  Acknowledgements
#  ----------------------------------------------------------------

Author wishes to acknowledge the contributions of the Full Stack Web Developer instuctors at Udacity.   Their course was challenging and rewarding!
